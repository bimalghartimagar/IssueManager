@page "/"
@using Domain.Model
@using IssueManager.Client.Blazor.WASM.Components.Widgets
@using IssueManager.Client.Blazor.WASM.Components.Tickets
@using IssueManager.Client.Blazor.WASM.Components.Shared
@using ThirdParty.Api.Interface
@inject ITicketService TicketFetchService

<WidgetList Data="@widgetData" />
<Spinner style="@(!IsLoading?"display: none":"")" />
<TicketListWrapper tickets="@tickets" />

@code {
    private bool IsLoading { get; set; }
    public Dictionary<string, int> widgetData = new Dictionary<string, int>(){
{ "open", 0},
{ "assigned", 0},
{ "closed", 0}
};

    List<Ticket> tickets = new List<Ticket>();

    protected override async Task OnInitializedAsync()
    {
        IsLoading = true;
        tickets = await TicketFetchService.GetTickets();
        tickets.ForEach(x =>
        {
            if (x.Status == "open")
            {
                widgetData["open"]++;
            }
            else if (x.Status == "assigned")
            {
                widgetData["assigned"]++;
            }
            else if (x.Status == "closed")
            {
                widgetData["closed"]++;
            }
        });
        IsLoading = false;
    }
}